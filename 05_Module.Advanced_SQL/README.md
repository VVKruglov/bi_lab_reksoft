Задания на использование CUBE:

Для выполнения задания используйте базу SalesHistoryDB.

Создайте куб по странам, городам, заказчикам, трем месяцам, категории продукта, подкатегории продукта, продукту, каналам, промокатегории.

Выставьте фильтры до 5-ти, но так, чтобы данных в итоговой таблице для ответа на вопрос было больше двух.

Решите задачи (таблица должна давать ответ на вопрос):

Самый покупающий заказчик в городе
Продукт на который заказчик готов тратить больше всего денег
Продажи за месяц и составляющие этого месяца по каналам, промокатегории и страны
 

Задания на использование WINDOW FUNCTIONS:
Для выполнения заданий используйте базу SalesHistoryDB:

Создать числовой ключ для таблицы со справочником стран.

Подготовительные действия — создание временной таблицы:

DROP TABLE IF EXISTS my_countries;

SELECT 0 AS id, c.country_id, c.country_name, c.country_subregion, c.country_region
INTO TEMPORARY my_countries
FROM sh.countries AS c;

SELECT * FROM my_countries;
Задача: заполнить во временной таблице стран (my_countries) числовое поле id уникальными последовательными значениями, начиная с 10.

Удалить дубликаты из справочника стран.

Подготовительные действия — создание справочника с дубликатами:

DROP TABLE IF EXISTS my_countries;

SELECT gen_random_uuid() AS id, c.*
INTO TEMPORARY my_countries
FROM sh.countries AS c
UNION ALL
SELECT gen_random_uuid(), c.* FROM sh.countries AS c
UNION ALL
SELECT gen_random_uuid(), c.* FROM sh.countries AS c;

SELECT * FROM my_countries;
Задача: удалить дубликаты из временной таблицы стран (my_countries) на основании значения поля country_id.

Отбор N первых значений по подгруппам.

Задача: Вывести названия трёх товаров, которые были проданы в максимальном количестве в последней (по времени) дате заказа для каждого из каналов продаж.

Поиск «разрывов» в последовательности.

Подготовительные действия — создание временной таблицы, содержащей числовую последовательность, включающую разрывы:

DROP TABLE IF EXISTS my_sequence;

CREATE TEMP TABLE my_sequence
(
    col1 INT NOT NULL PRIMARY KEY
);

INSERT INTO my_sequence (col1)
    VALUES (2),(3),(7),(8),(9),(11),(15),(16),(17),(28);
Задача: Найти границы «разрывов», т.е. диапазонов значений, не использованных (пропущенных) в последовательности, хранящейся в таблице. То есть для последовательности, созданной в подготовительных действиях, ожидается следующий результат:

Начало диапазона	Конец диапазона
4	6
10	10
12	14
18	27
Поиск «занятых» диапазонов в последовательности.

Подготовительные действия — аналогичные предыдущей задаче: создание временной таблицы, содержащей числовую последовательность, включающую разрывы:

DROP TABLE IF EXISTS my_sequence;

CREATE TEMP TABLE my_sequence
(
    col1 INT NOT NULL PRIMARY KEY
);

INSERT INTO my_sequence (col1)
    VALUES (2),(3),(7),(8),(9),(11),(15),(16),(17),(28);
Задача: Найти границы диапазонов, использованных значений. То есть для последовательности, созданной в подготовительных действиях, ожидается следующий результат:

Начало диапазона	Конец диапазона
2	3
7	9
11	11
15	17
28	28
Для выполнения заданий используйте базу DB_dvdrental:

Вывести страны, города, адреса покупателей из этих городов, общее количество покупателей для каждой страны, какой процент покупателей от общего числа составляют покупатели из этой страны (округлить значение до 4-х знаков после запятой). Решите задачу используя оконные функции
Для каждого актёра вывести ID, имя, фамилию, самый ранний фильм и самый последний фильм, в котором они снимались (по году релиза фильма).