Задание:
Имеется файл «airflights_passengers_denorm_export.csv», содержащий информацию об авиаперелётах. Эти данные выгружены из существующей базы данных, в которой они находятся в третьей нормальной форме. Для передачи данных в другую систему, была сделана выгрузка, в которой данные находятся в денормализованном виде. Вам, как дата инженеру, необходимо загрузить данные из источника, трансформировать их, и подготовить SQL запросы, которые помогут ответить на вопросы бизнес-пользователей.

Шаги выполнения задания:

На локальном экземпляре Postgres создайте новую базу данных «airflights_db». (1 балл)

Создайте в базе данных «airflights_db» новую схему «raw». (1 балл)

Создайте в схеме «raw» таблицу «airflights_passengers_denorm_exporting». Структура таблицы будет повторять структуру исходного файла «airflights_passengers_denorm_export.csv». Здесь очень важно выбирать верный формат колонок, чтобы при загрузке не потерять данные из файла. (1 балл)

Загрузите денормализованные данные из Excel файла в базу данных «airflights_db» в схему «raw». Для этого используйте команду «COPY» (LINK) (1 балл)

Напишите SQL запрос для подсчета количества записей в таблице «airflights_passengers_denorm_exporting». Убедитесь, что количество записей в таблице совпадает с количеством записей в исходном файле (1 балл)

Создайте в базе «airflights_db» схему «dds». (1 балл)

В схеме «dds» создайте все таблицы, необходимые для приведения данных из таблицы «raw.airflights_passengers_denorm_exporting» к 3 нормальной форме. Подумайте также над созданием необходимых ограничений (Constraints) (2 балла)

Напишите SQL запросы для копирования данных из «raw.airflights_passengers_denorm_exporting» в таблицы схемы «dds». (2 балла)
Подготовьте в draw.io логическую модель созданной базы данных (2 балла)


Решите следующие задачи:

Посчитайте, граждане какой страны летают больше всего (выведите первые 10 стран, отсортированные по убыванию количества перелётов). (1 балл)

Авиакомпании каких стран совершили самое большое количество рейсов (вывести 5 стран, упорядоченных по убыванию количества рейсов). (1 балл)

Каких рейсов больше: пассажирских или грузовых? (1 балл)
Подсчитайте процентное соотношение грузовых и пассажирских рейсов для различных авиакомпаний. (1 балл)

Найдите людей, которые наиболее часто путешествуют (выведите первые 20 с указанием количества перелётов, суммарного километража и суммарной стоимости всех билетов этого пассажира). (1 балл)

Найдите трех пассажиров, которые налетали больше всего километров с авиакомпанией «Deutsche Rettungsflugwacht». (1 балл)

Обновите данные с учётом 15% скидки на авиабилеты для этих (см. выше) пассажиров в этой компании. (1 балл)

Удалите из базы данных информацию о пассажирах, которые были зарегистрированы менее чем на 5 рейсов. (1 балл)

Добавьте пассажирский рейс, выполняемый авиакомпанией «Belavia Belarusian Airlines» по маршруту «Minsk International Airport» - «Warsaw, Poland» (на рейс зарегистрировано 57 пассажиров). (1 балл)
 